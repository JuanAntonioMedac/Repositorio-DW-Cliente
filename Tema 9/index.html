<!doctype html>
<html lang="en">

<head>
    <title>Formulario</title>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <!-- Bootstrap CSS v5.2.1 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.3.0/font/bootstrap-icons.css" />
</head>

<body>
    <header>
        <!-- place navbar here -->
    </header>
    <main>
        <div class="container py-3">
            <h4 class="card-title">Tema 9</h4>

            <div class="card mt-5">
                <div class="card-header">Formulario</div>

                <div class="card-body">
                    <form action="#" method="">
                        <div class="mb-3">
                            <label class="form-label">Nombre</label>
                            <input type="text" class="form-control" name="name" id="name" placeholder=""
                                onfocus="mensajeAyuda('name')" onblur="ocultarAyuda('name')" />
                            <small id="nameHelp" class="form-text "></small>
                            <br>
                            <small id="nameHelp2" class="form-text "></small>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" name="email" id="email" placeholder=""
                                onfocus="mensajeAyuda('email')" onblur="ocultarAyuda('email')" />
                            <small id="emailHelp" class="form-text "></small>
                            <br>
                            <small id="emailHelp2" class="form-text "></small>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Contraseña</label>
                            <input type="password" class="form-control pas" name="password" id="password" placeholder=""
                                onfocus="mensajeAyuda('password')" onblur="ocultarAyuda('password')" />
                            <i class="bi bi-eye-slash" id="togglePassword"></i>
                            <small id="passwordHelp" class="form-text "></small>
                            <br>
                            <small id="passwordHelp2" class="form-text "></small>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Edad</label>
                            <input type="number" class="form-control" name="edad" id="edad" placeholder=""
                                onfocus="mensajeAyuda('edad')" onblur="ocultarAyuda('edad')" />
                            <small id="edadHelp" class="form-text "></small>
                            <br>
                            <small id="edadHelp2" class="form-text "></small>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" value="si" id="recordarUsuario" />
                            <label class="form-check-label" for=""> Recordarme </label>
                        </div>

                        <button type="submit" class="btn btn-primary">
                            Enviar
                        </button>
                        <button type="button" onclick="eliminarCookie()" class="btn btn-outline-danger">
                            Eliminar cookie
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </main>
    <footer></footer>

    <!-- Bootstrap JavaScript Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js"
        crossorigin="anonymous"></script>

    <script>
        // Toggle contraseña
        const togglePassword = document.querySelector('#togglePassword');
        const password = document.getElementById("password");
        togglePassword.addEventListener('click', function () {
            const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
            password.setAttribute('type', type);
            this.classList.toggle('bi-eye');
        });

        // Leer cookie al cargar la página
        window.addEventListener("load", function () {
            const cookies = document.cookie.split(";").reduce((acc, cookie) => {
                const [name, value] = cookie.split("=");
                acc[name.trim()] = value ? value.trim() : "";
                return acc;
            }, {});

            if (cookies.usuario) {
                const nombre = decodeURIComponent(cookies.usuario);
                alert("Bienvenido de nuevo, " + nombre);
            }
        });

        // Funciones de validación
        function setValid(elemento, msgElemento, mensaje) {
            elemento.classList.add("is-valid");
            elemento.classList.remove("is-invalid");
            msgElemento.textContent = mensaje;
            msgElemento.classList.remove("text-danger");
            msgElemento.classList.add("text-success");
        }

        function setInvalid(elemento, msgElemento, mensaje) {
            elemento.classList.add("is-invalid");
            elemento.classList.remove("is-valid");
            msgElemento.textContent = mensaje;
            msgElemento.classList.remove("text-success");
            msgElemento.classList.add("text-danger");
        }

        function mensajeAyuda(campo) {
            const mensaje = {
                name: "Solo caracteres Alfabéticos",
                password: `• Al menos una letra mayúscula \n• Al menos un número \n• Al menos un símbolo !@#$%^&* \n• Mínimo 8 caracteres`,
                email: "Formato ejemplo aaa000@alu.medac.es",
                edad: "Edad mínima 16 años y máxima 99 años"
            };
            document.getElementById(campo + "Help").innerHTML = mensaje[campo];
        }

        function ocultarAyuda(campo) {
            document.getElementById(campo + "Help").innerHTML = "";
        }

        const regexName = /^[A-Za-zÁÉÍÓÚáéíóúÑñ ]+$/;
        const regexEmail = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        const regexPassword = /^(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*]).{8,}$/;
        const regexEdad = /^(1[6-9]|[2-9]\d)$/;

        function validarCampo(input, regex, msgElemento) {
            const value = input.value.trim();
            if (value === "") {
                input.classList.remove("is-valid", "is-invalid");
                msgElemento.textContent = "";
                return false;
            }

            const ok = regex.test(value);
            if (ok) {
                setValid(input, msgElemento, "Correcto");
                return true;
            } else {
                setInvalid(input, msgElemento, "Mensaje incorrecto");
                return false;
            }
        }

        const name = document.getElementById("name");
        const email = document.getElementById("email");
        const passwordInput = document.getElementById("password");
        const edad = document.getElementById("edad");

        const nameHelp = document.getElementById("nameHelp2");
        const emailHelp = document.getElementById("emailHelp2");
        const passwordHelp = document.getElementById("passwordHelp2");
        const edadHelp = document.getElementById("edadHelp2");

        name.addEventListener("input", () => validarCampo(name, regexName, nameHelp));
        email.addEventListener("input", () => validarCampo(email, regexEmail, emailHelp));
        passwordInput.addEventListener("input", () => validarCampo(passwordInput, regexPassword, passwordHelp));
        edad.addEventListener("input", () => validarCampo(edad, regexEdad, edadHelp));

        // Crear cookie "usuario"
        function setCookie(value, days) {
            const d = new Date();
            d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = "expires=" + d.toUTCString();
            document.cookie = "usuario=" + encodeURIComponent(value) + ";" + expires + ";path=/";
            console.log("Cookie creada: " + document.cookie);
        }

        // Eliminar cookie "usuario"
        function eliminarCookie() {
            document.cookie = "usuario=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/";
            alert("Cookie Eliminada");
            console.log("Cookies actuales: " + document.cookie);
        }

        // Manejar envío de formulario
        document.querySelector("form").addEventListener("submit", function (e) {
            e.preventDefault();

            const allOk =
                validarCampo(name, regexName, nameHelp) &&
                validarCampo(email, regexEmail, emailHelp) &&
                validarCampo(passwordInput, regexPassword, passwordHelp) &&
                validarCampo(edad, regexEdad, edadHelp);

            if (allOk) {
                setCookie(name.value, 7);
                alert("Formulario válido (simulado)");
            } else {
                alert("Hay errores. Revisa los campos.");
            }
        });
    </script>

</body>

</html>
